// Stash é…ç½®é¢„å¤„ç†è„šæœ¬ - ç»ˆæAIå·¥å…·é…ç½®å¢å¼ºç‰ˆ
// ç”¨äº Sub-Store çš„è„šæœ¬æ“ä½œ
// æ”¯æŒ ChatGPTã€Claudeã€Geminiã€æµåª’ä½“ç­‰å…¨é¢æœåŠ¡

// å›½å†…DNSæœåŠ¡å™¨
const domesticNameservers = [
  "223.5.5.5",
  "119.29.29.29",
  "114.114.114.114"
];

// å›½å¤–DNSæœåŠ¡å™¨
const foreignNameservers = [
  "https://dns.alidns.com/dns-query",
  "https://doh.pub/dns-query",
  "https://dns.google/dns-query"
];

// DNSé…ç½®
const dnsConfig = {
  enable: true,
  ipv6: false,
  listen: "0.0.0.0:53",
  "default-nameserver": domesticNameservers,
  nameserver: foreignNameservers,
  "enhanced-mode": "fake-ip",
  "fake-ip-range": "198.18.0.1/16",
  "fake-ip-filter": [
    "+.lan",
    "localhost.ptlogin2.qq.com",
    "*.battle.net",
    "*.blzstatic.cn",
    "*.battlenet.com",
    "*.battlenet.com.cn",
    "lens.l.google.com",
    "+.srv.nintendo.net",
    "+.stun.playstation.net",
    "+.msftncsi.com",
    "+.xboxlive.com",
    "msftconnecttest.com",
    "xbox.*.*.microsoft.com",
    "+.msftconnecttest.com",
    "*.msftncsi.com",
    "*.msftconnecttest.com",
    "*.mcdn.bilivideo.cn"
  ],
  fallback: [
    "https://1.1.1.1/dns-query",
    "tls://8.8.8.8:853",
    "tls://1.1.1.1:853"
  ],
  "fallback-filter": {
    geoip: true,
    "geoip-code": "CN",
    ipcidr: ["240.0.0.0/4", "0.0.0.0/32"],
    domain: ["+.google.com", "+.openai.com", "+.anthropic.com", "+.github.com"]
  }
};

// ä»£ç†æä¾›å•†é€šç”¨é…ç½®
const proxyProviderCommon = {
  interval: 600,
  "health-check": {
    enable: true,
    url: "http://www.gstatic.com/generate_204",
    interval: 300,
    timeout: 5000
  }
};

// ä»£ç†ç»„é€šç”¨é…ç½®
const groupBaseOption = {
  interval: 120,
  timeout: 3000,
  url: "http://www.gstatic.com/generate_204",
  lazy: true,
  tolerance: 50
};

// å›¾æ ‡åŸºç¡€è·¯å¾„
const iconBase = "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color";

// è¿œç¨‹è§„åˆ™é›†é…ç½®
const ruleProviderCommon = {
  type: "http",
  interval: 86400,
  behavior: "classical",
  format: "yaml"
};

// è§„åˆ™é›†åŸºç¡€ URL
const ruleBase = "https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash";

// è§„åˆ™é›†é…ç½®
const ruleProviders = {
  // å¹¿å‘Šæ‹¦æˆª
  reject: {
    ...ruleProviderCommon,
    behavior: "domain",
    url: `${ruleBase}/Advertising/Advertising.yaml`,
    path: "./ruleset/reject.yaml"
  },

  // AI æœåŠ¡è§„åˆ™é›†
  openai: {
    ...ruleProviderCommon,
    url: `${ruleBase}/OpenAI/OpenAI.yaml`,
    path: "./ruleset/openai.yaml"
  },

  // Apple æœåŠ¡
  icloud: {
    ...ruleProviderCommon,
    url: `${ruleBase}/iCloud/iCloud.yaml`,
    path: "./ruleset/icloud.yaml"
  },
  apple: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Apple/Apple.yaml`,
    path: "./ruleset/apple.yaml"
  },

  // Google æœåŠ¡
  google: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Google/Google.yaml`,
    path: "./ruleset/google.yaml"
  },
  youtube: {
    ...ruleProviderCommon,
    url: `${ruleBase}/YouTube/YouTube.yaml`,
    path: "./ruleset/youtube.yaml"
  },

  // æµåª’ä½“æœåŠ¡
  netflix: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Netflix/Netflix.yaml`,
    path: "./ruleset/netflix.yaml"
  },
  disney: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Disney/Disney.yaml`,
    path: "./ruleset/disney.yaml"
  },
  spotify: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Spotify/Spotify.yaml`,
    path: "./ruleset/spotify.yaml"
  },
  tiktok: {
    ...ruleProviderCommon,
    url: `${ruleBase}/TikTok/TikTok.yaml`,
    path: "./ruleset/tiktok.yaml"
  },

  // ç¤¾äº¤å¹³å°
  telegram: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Telegram/Telegram.yaml`,
    path: "./ruleset/telegram.yaml"
  },
  twitter: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Twitter/Twitter.yaml`,
    path: "./ruleset/twitter.yaml"
  },
  facebook: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Facebook/Facebook.yaml`,
    path: "./ruleset/facebook.yaml"
  },
  instagram: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Instagram/Instagram.yaml`,
    path: "./ruleset/instagram.yaml"
  },

  // GitHub
  github: {
    ...ruleProviderCommon,
    url: `${ruleBase}/GitHub/GitHub.yaml`,
    path: "./ruleset/github.yaml"
  },

  // Microsoft
  microsoft: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Microsoft/Microsoft.yaml`,
    path: "./ruleset/microsoft.yaml"
  },

  // æ¸¸æˆå¹³å°
  steam: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Steam/Steam.yaml`,
    path: "./ruleset/steam.yaml"
  },
  epicgames: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Epic/Epic.yaml`,
    path: "./ruleset/epicgames.yaml"
  },

  // ä»£ç†å’Œç›´è¿
  proxy: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Proxy/Proxy.yaml`,
    path: "./ruleset/proxy.yaml"
  },
  direct: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Direct/Direct.yaml`,
    path: "./ruleset/direct.yaml"
  },

  // å±€åŸŸç½‘
  private: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Lan/Lan.yaml`,
    path: "./ruleset/private.yaml"
  },

  // GFW
  gfw: {
    ...ruleProviderCommon,
    url: `${ruleBase}/Global/Global.yaml`,
    path: "./ruleset/gfw.yaml"
  },

  // IP è§„åˆ™
  telegramcidr: {
    ...ruleProviderCommon,
    behavior: "ipcidr",
    url: `${ruleBase}/Telegram/Telegram.yaml`,
    path: "./ruleset/telegramcidr.yaml"
  },
  cncidr: {
    ...ruleProviderCommon,
    behavior: "ipcidr",
    url: `${ruleBase}/ChinaIPs/ChinaIPs_IP.yaml`,
    path: "./ruleset/cncidr.yaml"
  },
  lancidr: {
    ...ruleProviderCommon,
    behavior: "ipcidr",
    url: `${ruleBase}/Lan/Lan_IP.yaml`,
    path: "./ruleset/lancidr.yaml"
  }
};

// è§„åˆ™é…ç½® - ä½¿ç”¨è¿œç¨‹è§„åˆ™é›†
const rules = [
  // å¹¿å‘Šæ‹¦æˆª
  "RULE-SET,reject,ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª",

  // å±€åŸŸç½‘ç›´è¿
  "RULE-SET,private,DIRECT",
  "RULE-SET,lancidr,DIRECT,no-resolve",

  // AI æœåŠ¡ - ä¼˜å…ˆçº§æœ€é«˜
  "DOMAIN-SUFFIX,openai.com,ğŸ§  ChatGPT",
  "DOMAIN-SUFFIX,chatgpt.com,ğŸ§  ChatGPT",
  "DOMAIN-SUFFIX,oaistatic.com,ğŸ§  ChatGPT",
  "DOMAIN-SUFFIX,oaiusercontent.com,ğŸ§  ChatGPT",
  "DOMAIN-KEYWORD,openai,ğŸ§  ChatGPT",
  "RULE-SET,openai,ğŸ§  ChatGPT",

  "DOMAIN-SUFFIX,anthropic.com,ğŸ’­ Claude",
  "DOMAIN-SUFFIX,claude.ai,ğŸ’­ Claude",
  "DOMAIN-KEYWORD,claude,ğŸ’­ Claude",

  "DOMAIN-SUFFIX,gemini.google.com,ğŸŒŸ GoogleæœåŠ¡",
  "DOMAIN-SUFFIX,bard.google.com,ğŸŒŸ GoogleæœåŠ¡",
  "DOMAIN-KEYWORD,gemini,ğŸŒŸ GoogleæœåŠ¡",

  "DOMAIN-SUFFIX,perplexity.ai,ğŸ”¬ AIå¹³å°",
  "DOMAIN-SUFFIX,huggingface.co,ğŸ”¬ AIå¹³å°",
  "DOMAIN-SUFFIX,poe.com,ğŸ”¬ AIå¹³å°",
  "DOMAIN-SUFFIX,character.ai,ğŸ”¬ AIå¹³å°",

  "DOMAIN-SUFFIX,midjourney.com,ğŸ¨ Midjourney",
  "DOMAIN-SUFFIX,discord.com,ğŸ¨ Midjourney",
  "DOMAIN-SUFFIX,discordapp.com,ğŸ¨ Midjourney",

  // æµåª’ä½“æœåŠ¡
  "RULE-SET,youtube,ğŸ“º YouTube",
  "DOMAIN-SUFFIX,googlevideo.com,ğŸ“º YouTube",
  "DOMAIN-SUFFIX,ytimg.com,ğŸ“º YouTube",

  "RULE-SET,netflix,ğŸ¬ Netflix",
  "DOMAIN-SUFFIX,nflximg.com,ğŸ¬ Netflix",
  "DOMAIN-SUFFIX,nflxvideo.net,ğŸ¬ Netflix",

  "RULE-SET,disney,ğŸ° Disney+",
  "DOMAIN-SUFFIX,disneyplus.com,ğŸ° Disney+",

  "RULE-SET,spotify,ğŸµ Spotify",
  "DOMAIN-SUFFIX,scdn.co,ğŸµ Spotify",

  "RULE-SET,tiktok,ğŸ“± TikTok",
  "DOMAIN-SUFFIX,tiktokcdn.com,ğŸ“± TikTok",
  "DOMAIN-KEYWORD,tiktok,ğŸ“± TikTok",

  // ç¤¾äº¤å¹³å°
  "RULE-SET,telegram,âœˆï¸ Telegram",
  "RULE-SET,telegramcidr,âœˆï¸ Telegram,no-resolve",
  "IP-CIDR,91.108.4.0/22,âœˆï¸ Telegram,no-resolve",
  "IP-CIDR,91.108.8.0/22,âœˆï¸ Telegram,no-resolve",
  "IP-CIDR,149.154.160.0/20,âœˆï¸ Telegram,no-resolve",

  "RULE-SET,twitter,ğŸ¦ Xå¹³å°",
  "DOMAIN-SUFFIX,x.com,ğŸ¦ Xå¹³å°",
  "DOMAIN-SUFFIX,twimg.com,ğŸ¦ Xå¹³å°",

  "RULE-SET,facebook,ğŸ“˜ Facebook",
  "DOMAIN-SUFFIX,fb.com,ğŸ“˜ Facebook",

  "RULE-SET,instagram,ğŸ“· Instagram",
  "DOMAIN-SUFFIX,cdninstagram.com,ğŸ“· Instagram",

  // å¼€å‘å·¥å…·
  "RULE-SET,github,ğŸ™ GitHub",
  "DOMAIN-SUFFIX,githubusercontent.com,ğŸ™ GitHub",
  "DOMAIN-SUFFIX,githubassets.com,ğŸ™ GitHub",

  // å¹³å°æœåŠ¡
  "RULE-SET,apple,ğŸ Apple",
  "RULE-SET,icloud,ğŸ Apple",

  "RULE-SET,google,ğŸŒŸ GoogleæœåŠ¡",
  "DOMAIN-SUFFIX,googleapis.com,ğŸŒŸ GoogleæœåŠ¡",
  "DOMAIN-SUFFIX,gstatic.com,ğŸŒŸ GoogleæœåŠ¡",

  "RULE-SET,microsoft,ğŸªŸ Microsoft",
  "DOMAIN-SUFFIX,office.com,ğŸªŸ Microsoft",
  "DOMAIN-SUFFIX,live.com,ğŸªŸ Microsoft",

  // æ¸¸æˆå¹³å°
  "RULE-SET,steam,ğŸ® æ¸¸æˆæœåŠ¡",
  "RULE-SET,epicgames,ğŸ® æ¸¸æˆæœåŠ¡",
  "DOMAIN-SUFFIX,steamcommunity.com,ğŸ® æ¸¸æˆæœåŠ¡",

  // å›½å¤–ç½‘ç«™
  "RULE-SET,proxy,ğŸš€ é€‰æ‹©ä»£ç†",
  "RULE-SET,gfw,ğŸš€ é€‰æ‹©ä»£ç†",

  // å›½å†…ç›´è¿
  "RULE-SET,direct,DIRECT",
  "RULE-SET,cncidr,DIRECT,no-resolve",

  // GeoIP
  "GEOIP,LAN,DIRECT,no-resolve",
  "GEOIP,CN,DIRECT,no-resolve",

  // å…œåº•è§„åˆ™
  "MATCH,ğŸŸ Final"
];

// ä¸»å‡½æ•° - Sub-Store è„šæœ¬æ“ä½œå…¥å£
function main(config) {
  try {
    const proxyCount = config?.proxies?.length ?? 0;
    const proxyProviderCount =
      typeof config?.["proxy-providers"] === "object" ? Object.keys(config["proxy-providers"]).length : 0;

    if (proxyCount === 0 && proxyProviderCount === 0) {
      console.log("âš ï¸ é…ç½®æ–‡ä»¶ä¸­æœªæ‰¾åˆ°ä»»ä½•ä»£ç†ï¼Œè¿”å›åŸå§‹é…ç½®");
      return config;
    }

    console.log(`ğŸ“Š æ‰¾åˆ° ${proxyCount} ä¸ªèŠ‚ç‚¹, ${proxyProviderCount} ä¸ªè®¢é˜…æº`);

    // è¦†ç›–åŸºç¡€é…ç½®
    config["mixed-port"] = 7890;
    config["allow-lan"] = true;
    config["bind-address"] = "*";
    config["ipv6"] = false;
    config["mode"] = "rule";
    config["log-level"] = "info";
    config["external-controller"] = "127.0.0.1:9090";

    // æ€§èƒ½ä¼˜åŒ–
    config["tcp-concurrent"] = true;
    config["find-process-mode"] = "strict";
    config["unified-delay"] = false;

    // è¦†ç›– DNS é…ç½®
    config["dns"] = dnsConfig;

    // åº”ç”¨ä»£ç†æä¾›å•†é€šç”¨é…ç½®
    if (config["proxy-providers"]) {
      Object.keys(config["proxy-providers"]).forEach(key => {
        config["proxy-providers"][key] = {
          ...proxyProviderCommon,
          ...config["proxy-providers"][key]
        };
      });
    }

    // å®šä¹‰è¿‡æ»¤å™¨å…³é”®è¯
    const filterKeywords = "å®˜ç½‘|å¥—é¤|æµé‡|expiring|å‰©ä½™|æ™‚é–“|é‡ç½®|åˆ°æœŸ|è¿‡æœŸ|æœºåœº|è®¢é˜…|ç»­è´¹|è§‚çœ‹|é¢‘é“|å®¢æœ|é€šçŸ¥|å…¬å‘Š|ä¸¥ç¦|æµ‹é€Ÿ";

    // é…ç½®ä»£ç†ç»„
    config["proxy-groups"] = [
      // === æ ¸å¿ƒæ§åˆ¶å™¨ ===
      {
        ...groupBaseOption,
        name: "ğŸš€ é€‰æ‹©ä»£ç†",
        type: "select",
        proxies: [
          "â™»ï¸ è‡ªåŠ¨é€‰æ‹©",
          "ğŸ§  ChatGPT",
          "ğŸ’­ Claude",
          "ğŸŒŸ GoogleæœåŠ¡",
          "ğŸ”¬ AIå¹³å°",
          "ğŸ“º YouTube",
          "ğŸ¬ Netflix",
          "âœˆï¸ Telegram",
          "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹",
          "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹",
          "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹",
          "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹",
          "DIRECT"
        ],
        icon: `${iconBase}/Available.png`
      },
      {
        ...groupBaseOption,
        name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©",
        type: "url-test",
        "include-all": true,
        icon: `${iconBase}/Auto.png`
      },

      // === AI å·¥å…·ä¸“ç”¨åˆ†ç»„ ===
      {
        ...groupBaseOption,
        name: "ğŸ§  ChatGPT",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹", "ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/ChatGPT.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ’­ Claude",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹", "ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Bot.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸŒŸ GoogleæœåŠ¡",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Google.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ”¬ AIå¹³å°",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Lab.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ¨ Midjourney",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Puzzle.png`
      },

      // === æµåª’ä½“æœåŠ¡ ===
      {
        ...groupBaseOption,
        name: "ğŸ“º YouTube",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/YouTube.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ¬ Netflix",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Netflix.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ° Disney+",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Disney+.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸµ Spotify",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Spotify.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ“± TikTok",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/TikTok.png`
      },

      // === ç¤¾äº¤å¹³å° ===
      {
        ...groupBaseOption,
        name: "âœˆï¸ Telegram",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Telegram.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ¦ Xå¹³å°",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Twitter.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ“˜ Facebook",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Facebook.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ“· Instagram",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Instagram.png`
      },

      // === å¹³å°æœåŠ¡ ===
      {
        ...groupBaseOption,
        name: "ğŸ Apple",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "DIRECT", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Apple.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸªŸ Microsoft",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "DIRECT", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Microsoft.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ™ GitHub",
        type: "select",
        proxies: ["ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/GitHub.png`
      },

      // === æ¸¸æˆæœåŠ¡ ===
      {
        ...groupBaseOption,
        name: "ğŸ® æ¸¸æˆæœåŠ¡",
        type: "select",
        proxies: ["ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹", "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹", "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹", "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹", "DIRECT", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"],
        icon: `${iconBase}/Game.png`
      },

      // === å¹¿å‘Šæ‹¦æˆª ===
      {
        ...groupBaseOption,
        name: "ğŸ›¡ï¸ å¹¿å‘Šæ‹¦æˆª",
        type: "select",
        proxies: ["REJECT", "DIRECT"],
        icon: `${iconBase}/AdBlack.png`
      },

      // === åœ°åŒºèŠ‚ç‚¹åˆ†ç»„ ===
      {
        ...groupBaseOption,
        name: "ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹",
        type: "url-test",
        "include-all": true,
        filter: "(?i)ğŸ‡­ğŸ‡°|æ¸¯|HK|Hong|HKG",
        icon: `${iconBase}/Hong_Kong.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹",
        type: "url-test",
        "include-all": true,
        filter: "(?i)ğŸ‡ºğŸ‡¸|ç¾|US|States|American|USA",
        icon: `${iconBase}/United_States.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡èŠ‚ç‚¹",
        type: "url-test",
        "include-all": true,
        filter: "(?i)ğŸ‡¸ğŸ‡¬|å¡|ç‹®åŸ|SG|Singapore|SGP",
        icon: `${iconBase}/Singapore.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹",
        type: "url-test",
        "include-all": true,
        filter: "(?i)ğŸ‡¯ğŸ‡µ|æ—¥|JP|Japan|JPN",
        icon: `${iconBase}/Japan.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ‡¬ğŸ‡§ è‹±å›½èŠ‚ç‚¹",
        type: "url-test",
        "include-all": true,
        filter: "(?i)ğŸ‡¬ğŸ‡§|è‹±|UK|Britain|United Kingdom|GBR",
        icon: `${iconBase}/United_Kingdom.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§èŠ‚ç‚¹",
        type: "url-test",
        "include-all": true,
        filter: "(?i)ğŸ‡¨ğŸ‡¦|åŠ |CA|Canada|CAN",
        icon: `${iconBase}/Canada.png`
      },
      {
        ...groupBaseOption,
        name: "ğŸ‡°ğŸ‡· éŸ©å›½èŠ‚ç‚¹",
        type: "url-test",
        "include-all": true,
        filter: "(?i)ğŸ‡°ğŸ‡·|éŸ©|KR|Korea|KOR",
        icon: `${iconBase}/Korea.png`
      },

      // === å…œåº•è§„åˆ™ ===
      {
        ...groupBaseOption,
        name: "ğŸŸ Final",
        type: "select",
        proxies: ["ğŸš€ é€‰æ‹©ä»£ç†", "â™»ï¸ è‡ªåŠ¨é€‰æ‹©", "DIRECT"],
        icon: `${iconBase}/Final.png`
      }
    ];

    // è¦†ç›–è§„åˆ™
    config["rules"] = rules;

    // è¦†ç›–è§„åˆ™é›†
    config["rule-providers"] = ruleProviders;

    // æ·»åŠ è„šæœ¬é…ç½®
    config["script"] = {
      shortcuts: {
        quic: "network == 'udp' and dst_port == 443"
      }
    };

    // ä¸ºæ‰€æœ‰èŠ‚ç‚¹å¯ç”¨ UDP
    if (config["proxies"]) {
      config["proxies"].forEach(proxy => {
        proxy.udp = true;
      });
      console.log(`âœ… å·²ä¸º ${config["proxies"].length} ä¸ªèŠ‚ç‚¹å¯ç”¨ UDP`);
    }

    console.log("ğŸ‰ é…ç½®å¤„ç†å®Œæˆ - ç»ˆæAIå·¥å…·é…ç½®å·²åº”ç”¨");
    console.log("ğŸ“¦ åŒ…å«ï¼šChatGPT, Claude, Gemini, YouTube, Netflix, Telegram ç­‰å®Œæ•´æ”¯æŒ");
    return config;

  } catch (error) {
    console.error("âŒ è„šæœ¬æ‰§è¡Œå‡ºé”™:", error.message);
    console.error("ğŸ“ é”™è¯¯å †æ ˆ:", error.stack);
    console.log("âš ï¸ è¿”å›åŸå§‹é…ç½®");
    return config;
  }
}

// å¯¼å‡ºé…ç½®
module.exports = main;
